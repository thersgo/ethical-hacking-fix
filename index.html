<!DOCTYPE html>
<html lang="et">

<head>
    <meta charset="UTF-8" />
    <title>Ethical Hacking – Demo rakendus</title>

    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-slate-100 flex items-center justify-center">
    <div id="app" class="w-full max-w-3xl p-6">

        <header class="mb-4 flex items-center justify-between">
            <h1 class="text-2xl font-bold text-slate-800">
                Ethical Hacking – Demo
            </h1>

            <div class="text-right text-xs text-slate-600">
                <p v-if="loggedInUser">
                    Sisselogitud: <span class="font-semibold">{{ loggedInUser.username }}</span>
                </p>
                <p v-else class="italic">Pole sisse logitud</p>
                <button v-if="loggedInUser" @click="logout" class="mt-1 text-xs text-red-600 hover:underline">
                    Logi välja
                </button>
            </div>
        </header>

        <!-- NAVI -->
        <nav class="flex flex-wrap gap-2 mb-5" v-if="loggedInUser">
            <button
                @click="currentPage = 'profile'"
                :class="navClass('profile')"
            >
                Profiil
            </button>
            <button
                @click="currentPage = 'admin'"
                :class="navClass('admin')"
                v-if="loggedInUser.role === 'admin'"
            >
                Admin paneel
            </button>
            <button
                @click="currentPage = 'settings'"
                :class="navClass('settings')"
            >
                Seaded & API
            </button>
            <button
                @click="currentPage = 'feedback'"
                :class="navClass('feedback')"
            >
                Tagasiside
            </button>
        </nav>

        <!-- LEHT: LOGIN -->
        <section v-if="currentPage === 'login'" class="bg-white shadow-md rounded-lg p-5">
            <h2 class="text-lg font-semibold mb-3">Login</h2>
            <p class="text-sm text-slate-600 mb-4">
                Proovi sisse logida. Kui ei õnnestu, mõtle, millised vead arendaja koodis teinud on.
            </p>

            <div class="mb-4">
                <label for="username" class="block text-sm font-medium mb-1 text-slate-700">
                    Kasutajanimi
                </label>
                <input id="username" v-model="username" placeholder="Sisesta kasutajanimi"
                    class="w-full border border-slate-300 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
            </div>

            <div class="mb-4">
                <label for="password" class="block text-sm font-medium mb-1 text-slate-700">
                    Parool
                </label>
                <input id="password" type="password" v-model="password" placeholder="Sisesta parool"
                    class="w-full border border-slate-300 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
            </div>

            <button @click="login"
                class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded hover:bg-blue-700 transition-colors">
                Logi sisse
            </button>

            <p v-if="message" class="mt-3 text-sm" :style="{ color: messageColor }">
                {{ message }}
            </p>
        </section>

        <!-- LEHT: PROFIIL -->
        <section v-else-if="currentPage === 'profile'" class="bg-white shadow-md rounded-lg p-5">
            <h2 class="text-lg font-semibold mb-3">Profiil</h2>

            <div v-if="!loggedInUser" class="text-sm text-red-600">
                Sa pole sisse logitud. Mine kõigepealt <span class="font-semibold">Login</span> lehele.
            </div>

            <div v-else class="space-y-2 text-sm text-slate-700">
                <p><span class="font-semibold">Kasutajanimi:</span> {{ loggedInUser.username }}</p>
                <p><span class="font-semibold">E-mail:</span> {{ loggedInUser.email }}</p>
                <p><span class="font-semibold">Roll:</span> {{ loggedInUser.role }}</p>
                <p><span class="font-semibold">Isiklik märkus:</span> {{ loggedInUser.personalNote }}</p>
            </div>
        </section>

        <!-- LEHT: ADMIN PANEEL -->
        <section v-else-if="currentPage === 'admin'" class="bg-white shadow-md rounded-lg p-5">
            <h2 class="text-lg font-semibold mb-3">Admin paneel</h2>

            <div class="overflow-x-auto">
                <table class="min-w-full text-xs border">
                    <thead class="bg-slate-100">
                        <tr>
                            <th class="border px-2 py-1 text-left">Kasutaja</th>
                            <th class="border px-2 py-1 text-left">E-mail</th>
                            <th class="border px-2 py-1 text-left">Roll</th>
                            <th class="border px-2 py-1 text-left">Parool (PLAINTEXT!)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="user in users" :key="user.username">
                            <td class="border px-2 py-1">{{ user.username }}</td>
                            <td class="border px-2 py-1">{{ user.email }}</td>
                            <td class="border px-2 py-1">{{ user.role }}</td>
                            <td class="border px-2 py-1 text-red-600 font-mono">{{ user.password }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- LEHT: SEADED & API -->
        <section v-else-if="currentPage === 'settings'" class="bg-white shadow-md rounded-lg p-5">
            <h2 class="text-lg font-semibold mb-3">Seaded & API</h2>

            <p class="text-sm text-slate-700 mb-3">
                Siin lehel on näha API võtmed ja autentimis-tokenid,
                mida EI tohiks kunagi frontendis niimoodi hoida.
            </p>

            <div class="space-y-3 text-xs font-mono bg-slate-50 border rounded p-3">
                <div>
                    <span class="font-semibold text-slate-700">FAKE_API_KEY:</span>
                    <span class="break-all text-slate-500">{{ apiKey }}</span>
                </div>
                <div>
                    <span class="font-semibold text-slate-700">FAKE_JWT_TOKEN:</span>
                    <span class="break-all text-slate-500">{{ jwtToken }}</span>
                </div>
                <div>
                    <span class="font-semibold text-slate-700">localStorage token:</span>
                    <span class="break-all text-slate-500">{{ storedToken }}</span>
                </div>
            </div>
        </section>

        <!-- LEHT: TAGASISIDE (XSS-ohtlik) -->
        <section v-else-if="currentPage === 'feedback'" class="bg-white shadow-md rounded-lg p-5">
            <h2 class="text-lg font-semibold mb-3">Tagasiside</h2>

            <p class="text-sm text-slate-700 mb-3">
                Siia saad kirjutada tagasisidet. Arendaja on otsustanud
                selle „ilusasti“ renderdada...
            </p>

            <textarea v-model="feedbackText" rows="3"
                class="w-full border border-slate-300 rounded px-3 py-2 text-sm mb-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="Kirjuta siia midagi (näiteks &lt;b&gt;rasvases&lt;/b&gt;)."></textarea>

            <button @click="submitFeedback"
                class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded hover:bg-blue-700 transition-colors">
                Salvesta tagasiside
            </button>

            <div class="mt-4 border-t pt-3">
                <h3 class="text-sm font-semibold mb-1">Viimane tagasiside (renderdatud otse HTML-ina):</h3>
                <!-- VÄGA HALB NÄIDE: v-html -->
                <div v-if="lastFeedback" class="prose prose-sm max-w-none border rounded p-2 bg-slate-50"
                    v-html="lastFeedback"></div>

                <p v-else class="text-xs text-slate-400">
                    Veel pole tagasisidet.
                </p>
            </div>
        </section>
    </div>

    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <!-- Meie rakenduse JS -->
    <script src="app.js"></script>
</body>

</html>